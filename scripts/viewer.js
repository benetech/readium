Readium.Views.ViewerApplicationView=Backbone.View.extend({el:"body",uiVisible:!1,initialize:function(){for(var a=this,b=0;b<Modernizr._domPrefixes.length;b++)if(document.documentElement[Modernizr._domPrefixes[b]+"RequestFullScreen"]!=null){this.model.set("supports_full_screen",!0);this.requestFullscreen=document.documentElement[Modernizr._domPrefixes[b]+"RequestFullScreen"];this.cancelFullscreen=document[Modernizr._domPrefixes[b]+"CancelFullScreen"];var c=Modernizr._domPrefixes[b];document[c+"FullscreenElement"]!==
void 0?c+="FullscreenElement":document[c+"FullScreenElement"]!==void 0&&(c+="FullScreenElement");this.getFullscreenElement=function(){return document[c]};$(document).bind(Modernizr._domPrefixes[b]+"fullscreenchange",function(){a.getFullscreenElement()==null?a.model.set("full_screen",!1):a.model.set("full_screen",!0)});break}this.model.on("change:full_screen",this.toggleFullscreen,this);this.model.on("change:current_theme",this.renderTheme,this);this.model.on("change:beeline_theme",this.renderTheme,
this);this.model.on("change:toolbar_visible",this.renderPageButtons,this);this.model.on("change:toc_visible",this.renderTocVisible,this);this.optionsView=new Readium.Views.OptionsView({model:this.model.options});this.optionsView.render();this.helpView=new Readium.Views.HelpView({model:_epubController});this.helpView.render();this.toolbar=new Readium.Views.ToolbarView({model:_epubController});this.toolbar.render();this.model.on("change:has_toc",this.init_toc,this);this.addGlobalEventHandlers()},toggleFullscreen:function(){this.model.get("full_screen")?
this.requestFullscreen.call(document.documentElement):this.cancelFullscreen.call(document)},addGlobalEventHandlers:function(){var a=this.model,b=this;window.onresize=function(){a.trigger("repagination_event")};$(document).keydown(function(a){b.allowAccessKey()&&(a.which==39&&b.model.paginator.v.pages.goRight(),a.which==37&&b.model.paginator.v.pages.goLeft())});$("#readium-book-view-el").on("swipeleft",function(a){b.allowAccessKey()&&(a.preventDefault(),b.model.paginator.v.pages.goRight())});$("#readium-book-view-el").on("swiperight",
function(a){b.allowAccessKey()&&(a.preventDefault(),b.model.paginator.v.pages.goLeft())})},allowAccessKey:function(){return $("#viewer-settings-modal").is(":visible")||$("#viewer-help-modal").is(":visible")?!1:!0},render:function(){this.renderTheme();this.renderPageButtons();this.renderTocVisible();return this},renderPageButtons:function(){var a=this.model.get("toolbar_visible");this.$("#prev-page-button").toggle(a);this.$("#next-page-button").toggle(a);return this},renderTheme:function(){var a=this.model.get("current_theme"),
b=this.model.get("beeline_theme"),c=this.model.get("beeline_object");c&&(a=="beeline-theme"?c.recolor():(this.$el.find("link#beeLineStyle").remove(),c.uncolor()));console.log("renderTheme theme in viewer.js: "+a+" beeline_theme: "+b);this.$el.toggleClass("default-theme","default-theme"===a||"beeline-theme"===a&&b!="night_gray");this.$el.toggleClass("night-theme","night-theme"===a||"beeline-theme"===a&&b=="night_gray");this.$el.toggleClass("parchment-theme","parchment-theme"===a);this.$("#readium-book-view-el").toggleClass("default-theme",
"default-theme"===a||"beeline-theme"===a&&b!="night_gray");this.$("#readium-book-view-el").toggleClass("night-theme","night-theme"===a||"beeline-theme"===a&&b=="night_gray");this.$("#readium-book-view-el").toggleClass("parchment-theme","parchment-theme"===a)},renderTocVisible:function(){var a=this.model.get("toc_visible");$("#toggle-toc-btn").attr("aria-pressed",a?"true":"false");this.$el.toggleClass("show-readium-toc",a);var b=this;a&&setTimeout(function(){b.toc.model.updateTocHighlight();b.$el.find(b.toc.model.get("toc_highlight_selector")).focus()},
50);return this},init_toc:function(){if(this.model.get("has_toc")){var a=this.model.getToc();this.toc=a.TocView();a.fetch()}},events:{"click #prev-page-button":function(){this.model.paginator.v.pages.goLeft()},"click #next-page-button":function(){this.model.paginator.v.pages.goRight()}}});
