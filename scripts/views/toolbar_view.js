Readium.Views.ToolbarView=Backbone.View.extend({el:"#toolbar-el",initialize:function(){this.model.set("toolbar_visible",Readium.Utils.getCookie("toolbar_visible")!=="false");this.model.on("change:toolbar_visible",this.renderBarVibility,this);this.model.on("change:full_screen",this.renderFullScreen,this);this.model.on("change:current_theme",this.renderThemeButton,this);if(this.hasTts=BookshareUtils.hasSpeechAPI())this.model.ttsPlayer.on("change:tts_playing",this.renderTtsButton,this)},render:function(){this.renderBarVibility();
this.renderFullScreen();this.renderThemeButton();this.renderTtsButton();return this},renderBarVibility:function(){var a=this.model.get("toolbar_visible");this.$("#show-toolbar-button").toggle(!a);this.$("#top-bar").toggle(a);return this},renderFullScreen:function(){if(this.model.get("supports_full_screen")){var a=this.model.get("full_screen");this.$("#go-to-fs-ico").toggle(!a);this.$("#leave-fs-ico").toggle(a);$("#fs-toggle-btn").attr("title",a?"Fullscreen on":"Fullscreen off");$("#fsOT").html(a?
"Fullscreen on":"Fullscreen off")}else this.$("#go-to-fs-ico").toggle(!1),this.$("#leave-fs-ico").toggle(!1),this.$("#fs-toggle-btn").toggle(!1);return this},renderThemeButton:function(){var a=this.model.get("current_theme")==="night-theme";this.$("#night-to-day-ico").toggle(a);this.$("#day-to-night-ico").toggle(!a);$("#nightmode-btn").attr("title",a?"Nightmode on":"Nightmode off");$("#nmOT").html(a?"Nightmode on":"Nightmode off");return this},renderTtsButton:function(){var a=!!this.model.ttsPlayer&&
this.model.ttsPlayer.get("tts_playing");this.$("#tts-on-ico").toggle(a);this.$("#tts-off-ico").toggle(!a);$("#play-tts-btn").attr("title",a?"Stop":"Play");$("#ttsOT").html(a?"Play":"Stop");return this},events:{"click #hide-toolbar-button":"hide_toolbar","click #show-toolbar-button":"show_toolbar","click #fs-toggle-btn":"toggle_fs","click #toggle-toc-btn":"toggle_toc","click #nightmode-btn":"toggle_night_mode","click #play-tts-btn":"play_tts"},show_toolbar:function(a){a.preventDefault();Readium.Utils.setCookie("toolbar_visible",
!0,365);this.model.set("toolbar_visible",!0)},hide_toolbar:function(a){a.preventDefault();Readium.Utils.setCookie("toolbar_visible",!1,365);this.model.set("toolbar_visible",!1)},toggle_fs:function(a){a.preventDefault();this.model.toggleFullScreen()},toggle_toc:function(a){a.preventDefault();this.model.toggleToc()},toggle_night_mode:function(){this.model.get("current_theme")==="night-theme"?this.model.get("day_theme")?(this.model.set("current_theme",this.model.get("day_theme")),Readium.Utils.setCookie("current_theme",
this.model.get("day_theme"),365)):(this.model.set("current_theme","default-theme"),Readium.Utils.setCookie("current_theme","default-theme",365)):(this.model.set("day_theme",this.model.get("current_theme")),this.model.set("current_theme","night-theme"),Readium.Utils.setCookie("current_theme","night-theme",365))},play_tts:function(){if(this.hasTts&&!BookshareUtils.isEdge()&&!BookshareUtils.isFirefox())this.model.ttsPlayer.get("tts_playing")?this.model.ttsPlayer.stop():this.model.ttsPlayer.play();else{var a=
"To read books aloud with text-to-speech and synchronized highlighting, please use the latest version of Google Chrome or Apple Safari on a computer. You can also read text aloud with a screen reader.";BookshareUtils.isIOS()?a="This browser does not support text-to-speech with synchronized highlighting, but you can use VoiceOver to have the contents of the book of the book read aloud.":BookshareUtils.isEdge()?a="We are awaiting updates from Microsoft that will support text-to-speech with synchronized highlighting in this browser. Until then, please use the latest version of Google Chrome or Apple Safari on a computer or you can also read text aloud with a screen reader.":
BookshareUtils.isFirefox()?a="To read books aloud with text-to-speech and synchronized highlighting, please use the latest version of Google Chrome or Apple Safari on a computer. You can also read text aloud with a screen reader.":BookshareUtils.isAndroidOrWindowsPhone()&&(a="This browser does not support text-to-speech with synchronized highlighting, but you can use TalkBack to have the contents of the book of the book read aloud.");$("#tts-browser-info .modal-body p").text(a);$("#tts-browser-info").modal("show")}}});
