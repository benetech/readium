Readium.Routers.ViewerRouter=Backbone.Router.extend({routes:{"viewer.html?book=:key":"openBook","rnibbookshare/viewer.html?book=:key":"openBook","load2learn/viewer.html?book=:key":"openBook","*splat":"splat_handler"},openBook:function(a){var d=this,b={url:BookshareUtils.resolveEnvironment(BookshareUtils.http+"www.bookshare.org/bookInfo?titleInstanceId="+a),dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},success:function(a){d.initViewer(a)},error:function(b){d.handleError(a,b)}};if(BookshareUtils.isIE9())b.dataType=
"jsonp",b.xhrFields=null;$.ajax(b)},initViewer:function(a){console.log("Initializing Book Viewer");window._epub=new Readium.Models.EPUB(a);window._epubController=new Readium.Models.EPUBController(_.extend({epub:window._epub},a));window._applicationView=new Readium.Views.ViewerApplicationView({model:window._epubController});window._applicationView.render()},handleError:function(a,d){var b={},c;switch(d.status){case 401:c="integration_error_401";b.loginUrl=BookshareUtils.resolveEnvironment(BookshareUtils.http+
"www.bookshare.org/");break;case 403:c="integration_error_403";break;case 404:c="integration_error_404";b.titleDetailPageUrl=BookshareUtils.resolveEnvironment(BookshareUtils.http+"www.bookshare.org/browse/book/"+a);break;default:c="integration_error"}BookshareUtils.raiseSystemAlert(c,b)},splat_handler:function(a){console.log(a)}});
