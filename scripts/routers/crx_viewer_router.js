Readium.Routers.ViewerRouter=Backbone.Router.extend({routes:{"views/viewer.html?book=:key":"openBook","*splat":"splat_handler"},openBook:function(a){key=a.split("&")[0];var c=this;$.ajax({url:BookshareUtils.resolveEnvironment(BookshareUtils.http+"www.bookshare.org/bookInfo?titleInstanceId="+key),dataType:"json",success:function(a){c.initViewer(a)},error:function(a){c.handleError(key,a)}})},initViewer:function(a){window._epub=new Readium.Models.EPUB(a);window._epubController=new Readium.Models.EPUBController(_.extend({epub:window._epub},
a));window._applicationView=new Readium.Views.ViewerApplicationView({model:window._epubController});window._applicationView.render()},handleError:function(a,c){var d={},b;switch(c.status){case 401:b="integration_error_401";d.loginUrl=BookshareUtils.resolveEnvironment(BookshareUtils.http+"www.bookshare.org/");break;case 403:b="integration_error_403";break;case 404:b="integration_error_404";d.titleDetailPageUrl=BookshareUtils.resolveEnvironment(BookshareUtils.http+"www.bookshare.org/browse/book/"+a);
break;default:b="integration_error"}BookshareUtils.raiseSystemAlert(b,d)},splat_handler:function(a){console.log(a)}});
